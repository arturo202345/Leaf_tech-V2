{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Auto Care Plant - Monitoreo Inteligente{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    {% block header %}
    <header>
        <div class="logo-box"></div>
        <div class="separator"></div>
        <nav>
            <a href="{% url 'index' %}" class="nav-link">Inicio</a>
            <a href="{% url 'manual_usuario' %}" class="nav-link">Manual de Usuario</a>
            <a href="{% url 'page1' %}" class="nav-link">Monitoreo</a>
            <a href="{% url 'mis_plantas' %}" class="nav-link">Mis Plantas</a>
        </nav>
        
        <div class="auth-container">
            {% if user.is_authenticated %}
                <div class="user-menu-container">
                    <div class="user-info" onclick="toggleDropdown()">
                        <div class="user-icon">{{ user.username|first|upper }}</div>
                        <span>{{ user.username|truncatechars:10 }}</span>
                    </div>
                    
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-header">
                            <div class="dropdown-user-name">{{ user.get_full_name|default:user.username|upper }}</div>
                            <div class="dropdown-user-email">{{ user.email|default:"Sin email" }}</div>
                            <div class="dropdown-user-id">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 16v-4M12 8h.01"></path>
                                </svg>
                                {{ user.username }}
                            </div>
                        </div>
                        
                        <div class="dropdown-section">
                            <a href="{% url 'logout' %}" class="dropdown-item logout">Cerrar sesión</a>
                        </div>
                    </div>
                </div>
            {% else %}
                <a class="auth-btn outline" href="{% url 'signin' %}">Iniciar Sesión</a>
                <a class="auth-btn" href="{% url 'signup' %}">Registrarse</a>
            {% endif %}
        </div>
    </header>
    {% endblock header %}

    {% block content %}
    {% endblock content %}

    <script>
        function toggleDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('active');
        }

        // Cerrar el dropdown si se hace clic fuera de él
        document.addEventListener('click', function(event) {
            const userMenu = document.querySelector('.user-menu-container');
            const dropdown = document.getElementById('userDropdown');
            
            if (userMenu && !userMenu.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Prevenir que el clic dentro del dropdown lo cierre
        const dropdownElement = document.querySelector('.user-dropdown');
        if (dropdownElement) {
            dropdownElement.addEventListener('click', function(event) {
                event.stopPropagation();
            });
        }
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>